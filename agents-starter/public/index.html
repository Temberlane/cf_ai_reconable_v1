<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconable Lite+ - Real-Time Agent Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .input-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .input-section h2 {
            color: #4a5568;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
        }

        .input-hint {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 0.5rem;
        }

        .input-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .example-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
        }

        .example-card h4 {
            color: #4a5568;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .example-card p {
            color: #718096;
            font-size: 0.8rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
        }

        .api-usage {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .api-usage h3 {
            color: #856404;
            margin-bottom: 0.5rem;
        }

        .api-usage p {
            color: #856404;
            font-size: 0.9rem;
        }

        .usage-bar {
            width: 100%;
            height: 8px;
            background: #ffeaa7;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffc107, #ff8c00);
            transition: width 0.3s ease;
        }

        .input-type-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .type-linkedin {
            background: #c6f6d5;
            color: #22543d;
        }

        .type-search {
            background: #bee3f8;
            color: #2a4365;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agent-status {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .agent {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .agent.active {
            border-left-color: #48bb78;
            background: #f0fff4;
            animation: pulse 2s infinite;
        }

        .agent.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }

        .agent-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .agent-info h3 {
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .agent-info p {
            color: #718096;
            font-size: 0.9rem;
        }

        .agent-status-indicator {
            margin-left: auto;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-idle { background: #e2e8f0; color: #4a5568; }
        .status-active { background: #c6f6d5; color: #22543d; }
        .status-error { background: #fed7d7; color: #742a2a; }
        .status-complete { background: #bee3f8; color: #2a4365; }

        .tool-calls {
            max-height: 400px;
            overflow-y: auto;
        }

        .tool-call {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .tool-call.active {
            border-left-color: #4299e1;
            background: #ebf8ff;
        }

        .tool-call.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .tool-call.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }

        .tool-icon {
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }

        .tool-info {
            flex: 1;
        }

        .tool-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .tool-description {
            font-size: 0.85rem;
            color: #718096;
        }

        .tool-timestamp {
            font-size: 0.75rem;
            color: #a0aec0;
        }

        .progress-section {
            grid-column: 1 / -1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #48bb78);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .step {
            text-align: center;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .step.active {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .step.complete {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .step.error {
            border-color: #f56565;
            background: #fed7d7;
        }

        .step-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .step-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .step-description {
            font-size: 0.8rem;
            color: #718096;
        }

        .data-section {
            grid-column: 1 / -1;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .data-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
        }

        .data-card h4 {
            color: #4a5568;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: #2d3748;
        }

        .data-value {
            color: #718096;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .logs {
            background: #1a202c;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-timestamp {
            color: #a0aec0;
        }

        .log-level-info { color: #63b3ed; }
        .log-level-success { color: #68d391; }
        .log-level-error { color: #fc8181; }
        .log-level-warning { color: #f6e05e; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Analysis Results Styles */
        .analysis-results {
            grid-column: 1 / -1;
            margin-bottom: 2rem;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .analysis-subject h3 {
            color: #2d3748;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .analysis-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .analysis-type {
            background: #bee3f8;
            color: #2a4365;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .analysis-confidence {
            background: #c6f6d5;
            color: #22543d;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .analysis-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .stat-item .stat-label {
            font-size: 0.8rem;
            color: #718096;
        }

        .analysis-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .analysis-section {
            background: #f7fafc;
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .analysis-section h4 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .summary-content {
            color: #2d3748;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .roles-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .role-item {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 3px solid #4299e1;
            font-weight: 500;
            color: #2d3748;
        }

        .timeline {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #48bb78;
        }

        .timeline-item .timeline-date {
            font-weight: 600;
            color: #4a5568;
            margin-right: 1rem;
            min-width: 80px;
        }

        .timeline-item .timeline-event {
            flex: 1;
            color: #2d3748;
        }

        .timeline-item .timeline-source {
            font-size: 0.8rem;
            color: #718096;
            margin-left: 1rem;
        }

        .compliance-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        /* LinkedIn Analysis Styles */
        .linkedin-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .score-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .score-label {
            font-size: 0.8rem;
            color: #718096;
            margin-bottom: 0.5rem;
        }

        .score-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
        }

        .linkedin-sections h5,
        .linkedin-keywords h5,
        .linkedin-engagement h5,
        .linkedin-recommendations h5 {
            font-size: 1rem;
            color: #2d3748;
            margin-bottom: 0.75rem;
            margin-top: 1.5rem;
            font-weight: 600;
        }

        .section-quality {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #4299e1;
        }

        .section-quality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .section-quality-name {
            font-weight: 600;
            color: #2d3748;
        }

        .quality-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .quality-badge.strong {
            background: #c6f6d5;
            color: #22543d;
        }

        .quality-badge.good {
            background: #bee3f8;
            color: #2c5282;
        }

        .quality-badge.weak {
            background: #fed7d7;
            color: #742a2a;
        }

        .section-quality-feedback {
            font-size: 0.85rem;
            color: #4a5568;
            line-height: 1.4;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .keyword-tag {
            background: #bee3f8;
            color: #2c5282;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .keyword-tag.missing {
            background: #feebc8;
            color: #7c2d12;
        }

        #profileRecommendations {
            margin: 0;
            padding-left: 1.5rem;
        }

        #profileRecommendations li {
            color: #2d3748;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .badge {
            background: #e2e8f0;
            color: #4a5568;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge.privacy { background: #c6f6d5; color: #22543d; }
        .badge.compliance { background: #bee3f8; color: #2a4365; }
        .badge.verified { background: #fef5e7; color: #744210; }

        /* Loading Animation for Tool Calls */
        .tool-call.loading {
            border-left-color: #48bb78;
            background: #f0fff4;
            position: relative;
            overflow: hidden;
        }

        .tool-call.loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(72, 187, 120, 0.3), transparent);
            animation: progressBar 2s infinite;
        }

        @keyframes progressBar {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .tool-call-counter {
            background: #4299e1;
            color: white;
            border-radius: 12px;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Reconable</h1>
            <p>Agent Based LinkedIn Profile Reviewer</p>
        </div>

        <!-- API Usage Warning -->
        <div class="api-usage">
            <h3>⚠️ Tool Usage Limit</h3>
            <p>You have <span id="remainingCalls">5</span> Tool calls remaining for this session.</p>
            <div class="usage-bar">
                <div class="usage-fill" id="usageFill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <h2>🔍 Start Analysis</h2>
            <div class="form-group">
                <label for="subject">Subject to Analyze:</label>
                <input type="text" id="subject" placeholder="Enter LinkedIn profile URL or search query (e.g., 'John Smith', 'Software Engineers in San Francisco')" value="">
                <div class="input-hint">
                    <span id="inputTypeIndicator" class="input-type-indicator type-search">Natural Language Search</span>
                    <span id="inputHint">Enter a name or search query to find and analyze LinkedIn profiles</span>
                </div>
            </div>
            
            <div class="input-examples">
                <div class="example-card">
                    <h4>🔗 LinkedIn Profile</h4>
                    <p>https://linkedin.com/in/example-profile</p>
                </div>
                <div class="example-card">
                    <h4>👤 Person Name</h4>
                    <p>John Smith</p>
                </div>
                <div class="example-card">
                    <h4>🏢 Company Search</h4>
                    <p>Software Engineers at Google</p>
                </div>
                <div class="example-card">
                    <h4>📍 Location Search</h4>
                    <p>Data Scientists in San Francisco</p>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="startBtn" class="btn">🚀 Start Analysis</button>
            <button id="stopBtn" class="btn btn-danger" disabled>⏹️ Stop</button>
            <button id="clearBtn" class="btn btn-secondary">🗑️ Clear</button>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalRuns">0</div>
                <div class="stat-label">Total Runs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeRuns">0</div>
                <div class="stat-label">Active Runs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="toolCalls">0</div>
                <div class="stat-label">Tool Calls</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="evidenceCollected">0</div>
                <div class="stat-label">Evidence Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiCallsUsed">0</div>
                <div class="stat-label">API Calls Used</div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="card progress-section">
            <h2>📊 Analysis Progress</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" id="step-intake">
                    <div class="step-icon">📥</div>
                    <div class="step-name">Intake</div>
                    <div class="step-description">Subject received</div>
                </div>
                <div class="step" id="step-discover">
                    <div class="step-icon">🔍</div>
                    <div class="step-name">Discover</div>
                    <div class="step-description">Finding sources</div>
                </div>
                <div class="step" id="step-fetch">
                    <div class="step-icon">🌐</div>
                    <div class="step-name">Fetch</div>
                    <div class="step-description">Web scraping</div>
                </div>
                <div class="step" id="step-normalize">
                    <div class="step-icon">🔄</div>
                    <div class="step-name">Normalize</div>
                    <div class="step-description">Processing data</div>
                </div>
                <div class="step" id="step-extract">
                    <div class="step-icon">📝</div>
                    <div class="step-name">Extract</div>
                    <div class="step-description">AI extraction</div>
                </div>
                <div class="step" id="step-verify">
                    <div class="step-icon">✅</div>
                    <div class="step-name">Verify</div>
                    <div class="step-description">Compliance check</div>
                </div>
                <div class="step" id="step-upsert">
                    <div class="step-icon">💾</div>
                    <div class="step-name">Upsert</div>
                    <div class="step-description">Store in memory</div>
                </div>
                <div class="step" id="step-synthesize">
                    <div class="step-icon">📊</div>
                    <div class="step-name">Synthesize</div>
                    <div class="step-description">Generate report</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Agent Status -->
            <div class="card">
                <h2>🤖 Agent Status</h2>
                <div class="agent-status">
                    <div class="agent" id="agent-orchestrator">
                        <div class="agent-icon">🎯</div>
                        <div class="agent-info">
                            <h3>Subject Orchestrator</h3>
                            <p>Manages the analysis pipeline</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                    <div class="agent" id="agent-harvester">
                        <div class="agent-icon">🌐</div>
                        <div class="agent-info">
                            <h3>Harvester Agent</h3>
                            <p>Web scraping and data collection</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                    <div class="agent" id="agent-compliance">
                        <div class="agent-icon">🛡️</div>
                        <div class="agent-info">
                            <h3>Compliance Agent</h3>
                            <p>Privacy and data verification</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                </div>
            </div>

            <!-- Tool Calls -->
            <div class="card">
                <h2>🔧 Tool Calls</h2>
                <div class="tool-calls" id="toolCallsList">
                    <div style="text-align: center; color: #a0aec0; padding: 2rem;">
                        No tool calls yet. Start an analysis to see activity.
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Analysis Results -->
        <div class="card analysis-results" id="analysisResults" style="display: none;">
            <h2>📊 Final Analysis Report</h2>
            <div class="analysis-header">
                <div class="analysis-subject">
                    <h3 id="analysisSubject">Subject Name</h3>
                    <div class="analysis-meta">
                        <span class="analysis-type" id="analysisType">Search Query</span>
                        <span class="analysis-confidence" id="analysisConfidence">Confidence: 85%</span>
                    </div>
                </div>
                <div class="analysis-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="analysisEvidenceCount">0</span>
                        <span class="stat-label">Evidence Items</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="analysisClaimsCount">0</span>
                        <span class="stat-label">Claims Verified</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="analysisApiCalls">0</span>
                        <span class="stat-label">API Calls Used</span>
                    </div>
                </div>
            </div>
            
            <div class="analysis-content">
                <div class="analysis-section">
                    <h4>📝 Executive Summary</h4>
                    <div class="summary-content" id="analysisSummary">
                        Analysis in progress...
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>🎯 Key Roles & Positions</h4>
                    <div class="roles-list" id="analysisRoles">
                        <div class="role-item">Loading roles...</div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>📅 Timeline</h4>
                    <div class="timeline" id="analysisTimeline">
                        <div class="timeline-item">Loading timeline...</div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h4>🛡️ Privacy & Compliance</h4>
                    <div class="compliance-badges" id="analysisCompliance">
                        <span class="badge">Loading compliance info...</span>
                    </div>
                </div>
                
                <div class="analysis-section" id="linkedinAnalysisSection" style="display: none;">
                    <h4>💼 LinkedIn Profile Analysis</h4>
                    
                    <div class="linkedin-scores">
                        <div class="score-card">
                            <div class="score-label">Profile Strength</div>
                            <div class="score-value" id="profileStrength">-</div>
                        </div>
                        <div class="score-card">
                            <div class="score-label">Completeness</div>
                            <div class="score-value" id="profileCompleteness">-</div>
                        </div>
                        <div class="score-card">
                            <div class="score-label">Keyword Score</div>
                            <div class="score-value" id="keywordScore">-</div>
                        </div>
                        <div class="score-card">
                            <div class="score-label">Traction</div>
                            <div class="score-value" id="tractionRating">-</div>
                        </div>
                    </div>
                    
                    <div class="linkedin-sections">
                        <h5>Profile Sections</h5>
                        <div id="profileSections"></div>
                    </div>
                    
                    <div class="linkedin-keywords">
                        <h5>🔍 Keyword Optimization</h5>
                        <div id="keywordAnalysis"></div>
                    </div>
                    
                    <div class="linkedin-engagement">
                        <h5>📊 Engagement Metrics</h5>
                        <div id="engagementMetrics"></div>
                    </div>
                    
                    <div class="linkedin-recommendations">
                        <h5>💡 Recommendations for Improvement</h5>
                        <ul id="profileRecommendations"></ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Section -->
        <div class="card data-section">
            <h2>📊 Collected Data</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h4>🌐 Web Search Results</h4>
                    <div id="webData">
                        <div class="data-item">
                            <span class="data-label">Status:</span>
                            <span class="data-value">Not started</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>💼 LinkedIn Profiles</h4>
                    <div id="linkedinData">
                        <div class="data-item">
                            <span class="data-label">Profiles Found:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Profiles Scraped:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>🏢 Company Data</h4>
                    <div id="companyData">
                        <div class="data-item">
                            <span class="data-label">Companies Found:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Data Points:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>📝 AI Analysis</h4>
                    <div id="aiData">
                        <div class="data-item">
                            <span class="data-label">Claims Extracted:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Claims Verified:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <h2>📋 Activity Logs</h2>
            <div class="logs" id="logs">
                <div class="log-entry">
                    <span class="log-timestamp">[00:00:00]</span>
                    <span class="log-level-info">[INFO]</span>
                    <span>Dashboard initialized. Ready to start analysis.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AgentDashboard {
            constructor() {
                this.currentRunId = null;
                this.isRunning = false;
                this.maxApiCalls = 5;
                this.apiCallsUsed = 0;
                this.inputType = 'search'; // 'linkedin' or 'search'
                
                this.agents = {
                    orchestrator: document.getElementById('agent-orchestrator'),
                    harvester: document.getElementById('agent-harvester'),
                    compliance: document.getElementById('agent-compliance')
                };
                this.steps = {
                    intake: document.getElementById('step-intake'),
                    discover: document.getElementById('step-discover'),
                    fetch: document.getElementById('step-fetch'),
                    normalize: document.getElementById('step-normalize'),
                    extract: document.getElementById('step-extract'),
                    verify: document.getElementById('step-verify'),
                    upsert: document.getElementById('step-upsert'),
                    synthesize: document.getElementById('step-synthesize')
                };
                this.stats = {
                    totalRuns: document.getElementById('totalRuns'),
                    activeRuns: document.getElementById('activeRuns'),
                    toolCalls: document.getElementById('toolCalls'),
                    evidenceCollected: document.getElementById('evidenceCollected'),
                    apiCallsUsed: document.getElementById('apiCallsUsed')
                };
                this.toolCallsList = document.getElementById('toolCallsList');
                this.logs = document.getElementById('logs');
                this.progressFill = document.getElementById('progressFill');
                this.subjectInput = document.getElementById('subject');
                this.inputTypeIndicator = document.getElementById('inputTypeIndicator');
                this.inputHint = document.getElementById('inputHint');
                this.remainingCalls = document.getElementById('remainingCalls');
                this.usageFill = document.getElementById('usageFill');
                
            this.toolCallCount = 0;
            this.evidenceCount = 0;
            this.totalRuns = 0;
            this.activeToolCalls = new Map(); // Track active tool calls for loading animation
            this.toolCallCounts = new Map(); // Track how many times each tool has been called
            
            this.initializeEventListeners();
            this.startPolling();
            this.updateApiUsage();
            }

            initializeEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startAnalysis());
                document.getElementById('stopBtn').addEventListener('click', () => this.stopAnalysis());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearDashboard());
                
                // Input type detection
                this.subjectInput.addEventListener('input', () => this.detectInputType());
            }

            detectInputType() {
                const input = this.subjectInput.value.trim();
                
                if (input.includes('linkedin.com/in/') || input.includes('linkedin.com/company/')) {
                    this.inputType = 'linkedin';
                    this.inputTypeIndicator.textContent = 'LinkedIn Profile';
                    this.inputTypeIndicator.className = 'input-type-indicator type-linkedin';
                    this.inputHint.textContent = 'Direct LinkedIn profile - will scrape this specific profile';
                } else if (input.length > 0) {
                    this.inputType = 'search';
                    this.inputTypeIndicator.textContent = 'Natural Language Search';
                    this.inputTypeIndicator.className = 'input-type-indicator type-search';
                    this.inputHint.textContent = 'Search query - will find and analyze up to 5 LinkedIn profiles';
                } else {
                    this.inputType = 'search';
                    this.inputTypeIndicator.textContent = 'Natural Language Search';
                    this.inputTypeIndicator.className = 'input-type-indicator type-search';
                    this.inputHint.textContent = 'Enter a name or search query to find and analyze LinkedIn profiles';
                }
            }

            async startAnalysis() {
                const subject = this.subjectInput.value.trim();
                if (!subject) {
                    this.addLog('Please enter a subject name or LinkedIn profile URL.', 'error');
                    return;
                }

                // Check API usage limit
                if (this.apiCallsUsed >= this.maxApiCalls) {
                    this.addLog('API usage limit reached. Please wait or start a new session.', 'error');
                    return;
                }

                this.isRunning = true;
                this.updateButtons();
                this.resetDashboard();
                
                const analysisType = this.inputType === 'linkedin' ? 'LinkedIn Profile' : 'Search Query';
                this.addLog(`Starting ${analysisType} analysis for: ${subject}`, 'info');

                try {
                    const response = await fetch('/api/run', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            subject,
                            inputType: this.inputType,
                            maxApiCalls: this.maxApiCalls - this.apiCallsUsed
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        this.currentRunId = data.runId;
                        this.totalRuns++;
                        this.updateStats();
                        this.addLog(`Analysis started with Run ID: ${data.runId}`, 'success');
                        this.activateAgent('orchestrator');
                        this.activateStep('intake');
                        
                        // Simulate API usage
                        if (this.inputType === 'linkedin') {
                            this.apiCallsUsed += 1;
                        } else {
                            this.apiCallsUsed += Math.min(5, data.estimatedCalls || 5);
                        }
                        this.updateApiUsage();
                        
                    } else {
                        this.addLog(`Failed to start analysis: ${data.error}`, 'error');
                        this.isRunning = false;
                        this.updateButtons();
                    }
                } catch (error) {
                    this.addLog(`Network error: ${error.message}`, 'error');
                    this.isRunning = false;
                    this.updateButtons();
                }
            }

            async stopAnalysis() {
                this.isRunning = false;
                this.updateButtons();
                this.addLog('Analysis stopped by user', 'warning');
                this.deactivateAllAgents();
                this.resetSteps();
            }

            clearDashboard() {
                this.resetDashboard();
                this.addLog('Dashboard cleared', 'info');
            }

            resetDashboard() {
                this.deactivateAllAgents();
                this.resetSteps();
                this.toolCallsList.innerHTML = '<div style="text-align: center; color: #a0aec0; padding: 2rem;">No tool calls yet. Start an analysis to see activity.</div>';
                this.progressFill.style.width = '0%';
                this.updateDataDisplays();
                
                // Hide analysis results
                const analysisResults = document.getElementById('analysisResults');
                if (analysisResults) {
                    analysisResults.style.display = 'none';
                }
                
                // Clear active tool calls and counts
                this.activeToolCalls.clear();
                this.toolCallCounts.clear();
            }

            updateButtons() {
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                startBtn.disabled = this.isRunning || this.apiCallsUsed >= this.maxApiCalls;
                stopBtn.disabled = !this.isRunning;
                
                if (this.isRunning) {
                    startBtn.innerHTML = '<span class="loading"></span> Running...';
                } else if (this.apiCallsUsed >= this.maxApiCalls) {
                    startBtn.innerHTML = '🚫 API Limit Reached';
                } else {
                    startBtn.innerHTML = '🚀 Start Analysis';
                }
            }

            updateApiUsage() {
                this.remainingCalls.textContent = this.maxApiCalls - this.apiCallsUsed;
                const usagePercent = (this.apiCallsUsed / this.maxApiCalls) * 100;
                this.usageFill.style.width = `${usagePercent}%`;
                this.updateStats();
            }

            activateAgent(agentName) {
                const agent = this.agents[agentName];
                agent.classList.add('active');
                agent.querySelector('.agent-status-indicator').textContent = 'Active';
                agent.querySelector('.agent-status-indicator').className = 'agent-status-indicator status-active';
            }

            deactivateAgent(agentName) {
                const agent = this.agents[agentName];
                agent.classList.remove('active');
                agent.querySelector('.agent-status-indicator').textContent = 'Idle';
                agent.querySelector('.agent-status-indicator').className = 'agent-status-indicator status-idle';
            }

            deactivateAllAgents() {
                Object.keys(this.agents).forEach(agentName => this.deactivateAgent(agentName));
            }

            activateStep(stepName) {
                const step = this.steps[stepName];
                step.classList.add('active');
                this.updateProgress();
            }

            completeStep(stepName) {
                const step = this.steps[stepName];
                step.classList.remove('active');
                step.classList.add('complete');
                this.updateProgress();
            }

            resetSteps() {
                Object.values(this.steps).forEach(step => {
                    step.classList.remove('active', 'complete', 'error');
                });
            }

            updateProgress() {
                const activeSteps = Object.values(this.steps).filter(step => 
                    step.classList.contains('active') || step.classList.contains('complete')
                ).length;
                const progress = (activeSteps / Object.keys(this.steps).length) * 100;
                this.progressFill.style.width = `${progress}%`;
            }

            addToolCall(toolName, description, status = 'active', toolId = null) {
                this.toolCallCount++;
                this.updateStats();

                // Track tool call counts
                const currentCount = this.toolCallCounts.get(toolName) || 0;
                this.toolCallCounts.set(toolName, currentCount + 1);

                // If this is a loading tool call, check if we already have it
                if (status === 'loading' && toolId) {
                    if (this.activeToolCalls.has(toolId)) {
                        return; // Already showing loading for this tool
                    }
                    this.activeToolCalls.set(toolId, true);
                }

                // Check if we already have this tool call and update it instead of creating new
                const existingToolCall = this.toolCallsList.querySelector(`[data-tool-name="${toolName}"]`);
                
                if (existingToolCall) {
                    // Update existing tool call with new count
                    const count = this.toolCallCounts.get(toolName);
                    const counterElement = existingToolCall.querySelector('.tool-call-counter');
                    if (counterElement) {
                        counterElement.textContent = `${count}x`;
                    } else {
                        const toolInfo = existingToolCall.querySelector('.tool-info');
                        toolInfo.innerHTML += `<span class="tool-call-counter">${count}x</span>`;
                    }
                    return;
                }

                const toolCall = document.createElement('div');
                toolCall.className = `tool-call ${status}`;
                toolCall.setAttribute('data-tool-name', toolName);
                if (toolId) toolCall.setAttribute('data-tool-id', toolId);
                
                const icons = {
                    'searchWeb': '🔍',
                    'fetchWeb': '🌐',
                    'scrapeLinkedInProfile': '💼',
                    'searchLinkedInProfiles': '🔎',
                    'scrapeLinkedInCompany': '🏢',
                    'extractClaims': '📝',
                    'verifyClaims': '✅',
                    'synthesizeReport': '📊'
                };

                const count = this.toolCallCounts.get(toolName);
                const counterDisplay = count > 1 ? `<span class="tool-call-counter">${count}x</span>` : '';

                toolCall.innerHTML = `
                    <div class="tool-icon">${icons[toolName] || '🔧'}</div>
                    <div class="tool-info">
                        <div class="tool-name">${toolName}${counterDisplay}</div>
                        <div class="tool-description">${description}</div>
                    </div>
                    <div class="tool-timestamp">${new Date().toLocaleTimeString()}</div>
                `;

                if (this.toolCallsList.children.length === 1 && this.toolCallsList.children[0].textContent.includes('No tool calls')) {
                    this.toolCallsList.innerHTML = '';
                }

                this.toolCallsList.insertBefore(toolCall, this.toolCallsList.firstChild);

                // Keep only last 20 tool calls
                while (this.toolCallsList.children.length > 20) {
                    this.toolCallsList.removeChild(this.toolCallsList.lastChild);
                }
            }

            updateToolCallStatus(toolId, status, description = null) {
                const toolCall = this.toolCallsList.querySelector(`[data-tool-id="${toolId}"]`);
                if (toolCall) {
                    toolCall.className = `tool-call ${status}`;
                    if (description) {
                        toolCall.querySelector('.tool-description').textContent = description;
                    }
                    if (status !== 'loading') {
                        this.activeToolCalls.delete(toolId);
                    }
                }
            }

            addLog(message, level = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                    <span>${message}</span>
                `;
                
                this.logs.appendChild(logEntry);
                this.logs.scrollTop = this.logs.scrollHeight;

                // Keep only last 100 log entries
                while (this.logs.children.length > 100) {
                    this.logs.removeChild(this.logs.firstChild);
                }
            }

            updateStats() {
                this.stats.totalRuns.textContent = this.totalRuns;
                this.stats.activeRuns.textContent = this.isRunning ? '1' : '0';
                this.stats.toolCalls.textContent = this.toolCallCount;
                this.stats.evidenceCollected.textContent = this.evidenceCount;
                this.stats.apiCallsUsed.textContent = this.apiCallsUsed;
            }

            updateDataDisplays() {
                // Update web data
                document.querySelector('#webData .data-value').textContent = this.isRunning ? 'In progress...' : 'Not started';
                
                // Update LinkedIn data
                const linkedinProfiles = document.querySelectorAll('#linkedinData .data-value');
                if (linkedinProfiles.length >= 2) {
                    linkedinProfiles[0].textContent = this.evidenceCount;
                    linkedinProfiles[1].textContent = this.evidenceCount;
                }
                
                // Update company data
                const companyData = document.querySelectorAll('#companyData .data-value');
                if (companyData.length >= 2) {
                    companyData[0].textContent = Math.floor(this.evidenceCount / 2);
                    companyData[1].textContent = this.evidenceCount * 3;
                }
                
                // Update AI data
                const aiData = document.querySelectorAll('#aiData .data-value');
                if (aiData.length >= 2) {
                    aiData[0].textContent = this.evidenceCount * 2;
                    aiData[1].textContent = Math.floor(this.evidenceCount * 1.8);
                }
            }

            async checkRunStatus() {
                if (!this.currentRunId || !this.isRunning) return;

                try {
                    const response = await fetch(`/api/run/${this.currentRunId}/status`);
                    const data = await response.json();

                    if (response.ok) {
                        this.updateRunStatus(data);
                    }
                } catch (error) {
                    console.error('Failed to check run status:', error);
                }
            }

            updateRunStatus(runData) {
                const status = runData.status;
                
                if (status === 'completed') {
                    this.completeAnalysis();
                } else if (status === 'error') {
                    this.handleError(runData.error);
                } else {
                    this.simulateProgress(status);
                }
            }

            simulateProgress(currentStatus) {
                // Simulate realistic progress with tool calls
                const progressSequence = [
                    { step: 'intake', agent: 'orchestrator', tool: 'initializeRun', desc: 'Initializing analysis run' },
                    { step: 'discover', agent: 'harvester', tool: this.inputType === 'linkedin' ? 'scrapeLinkedInProfile' : 'searchLinkedInProfiles', desc: this.inputType === 'linkedin' ? 'Scraping specific LinkedIn profile' : 'Searching LinkedIn profiles' },
                    { step: 'fetch', agent: 'harvester', tool: 'scrapeLinkedInProfile', desc: 'Scraping LinkedIn profile data' },
                    { step: 'fetch', agent: 'harvester', tool: 'fetchWeb', desc: 'Fetching additional web content' },
                    { step: 'normalize', agent: 'orchestrator', tool: 'processEvidence', desc: 'Processing collected evidence' },
                    { step: 'extract', agent: 'orchestrator', tool: 'extractClaims', desc: 'Extracting claims using AI' },
                    { step: 'verify', agent: 'compliance', tool: 'verifyClaims', desc: 'Verifying claims for compliance' },
                    { step: 'upsert', agent: 'orchestrator', tool: 'storeClaims', desc: 'Storing claims in memory' },
                    { step: 'synthesize', agent: 'orchestrator', tool: 'synthesizeReport', desc: 'Generating final report' }
                ];

                const currentIndex = progressSequence.findIndex(p => p.step === currentStatus);
                if (currentIndex >= 0) {
                    const current = progressSequence[currentIndex];
                    this.activateAgent(current.agent);
                    this.activateStep(current.step);
                    
                    // Add loading tool call for scraping operations
                    if (current.tool === 'scrapeLinkedInProfile' || current.tool === 'searchLinkedInProfiles') {
                        const toolId = `${current.tool}_${Date.now()}`;
                        this.addToolCall(current.tool, `${current.desc} (loading...)`, 'loading', toolId);
                        
                        // Simulate multiple calls for scraping operations
                        if (current.tool === 'scrapeLinkedInProfile') {
                            // Simulate scraping multiple profiles
                            setTimeout(() => this.addToolCall(current.tool, `${current.desc} (loading...)`, 'loading'), 1000);
                            setTimeout(() => this.addToolCall(current.tool, `${current.desc} (loading...)`, 'loading'), 2000);
                        }
                        
                        // Simulate completion after a delay
                        setTimeout(() => {
                            this.updateToolCallStatus(toolId, 'success', `${current.desc} completed`);
                        }, 2000 + Math.random() * 3000); // 2-5 seconds
                    } else {
                        this.addToolCall(current.tool, current.desc, 'active');
                        
                        // Simulate multiple calls for some operations
                        if (current.tool === 'extractClaims' || current.tool === 'verifyClaims') {
                            setTimeout(() => this.addToolCall(current.tool, current.desc, 'active'), 500);
                        }
                    }
                    
                    // Simulate evidence collection
                    if (current.step === 'fetch') {
                        this.evidenceCount += this.inputType === 'linkedin' ? 1 : Math.floor(Math.random() * 3) + 1;
                        this.updateStats();
                        this.updateDataDisplays();
                    }
                }
            }

            async completeAnalysis() {
                this.addLog('Analysis completed successfully!', 'success');
                this.completeStep('synthesize');
                this.deactivateAllAgents();
                this.isRunning = false;
                this.updateButtons();
                this.updateStats();
                this.updateDataDisplays();
                
                // Fetch and display real analysis results
                await this.displayAnalysisResults();
            }

            async displayAnalysisResults() {
                const analysisResults = document.getElementById('analysisResults');
                const subject = this.subjectInput.value.trim();
                
                this.addLog('Fetching final analysis report from API...', 'info');
                
                try {
                    // Fetch the real report from the API
                    const response = await fetch(`/api/run/${this.currentRunId}/report`);
                    
                    if (!response.ok) {
                        throw new Error(`Failed to fetch report: ${response.status}`);
                    }
                    
                    const reportData = await response.json();
                    
                    if (!reportData || !reportData.synthesis) {
                        this.addLog('No synthesis data available, using fallback', 'warning');
                        this.displayFallbackResults(subject);
                        return;
                    }
                    
                    const synthesis = reportData.synthesis;
                    const run = reportData.run;
                    const evidence = reportData.evidence || [];
                    const claims = reportData.claims || [];
                    
                    this.addLog('Report fetched successfully, displaying results...', 'success');
                    
                    // Update analysis header
                    document.getElementById('analysisSubject').textContent = run.subject_name || subject;
                    document.getElementById('analysisType').textContent = this.inputType === 'linkedin' ? 'LinkedIn Profile' : 'Search Query';
                    document.getElementById('analysisConfidence').textContent = `Confidence: ${Math.round((synthesis.confidence_score || 0.85) * 100)}%`;
                    
                    // Update stats
                    document.getElementById('analysisEvidenceCount').textContent = evidence.length;
                    document.getElementById('analysisClaimsCount').textContent = claims.length;
                    document.getElementById('analysisApiCalls').textContent = this.apiCallsUsed;
                    
                    // Update content
                    document.getElementById('analysisSummary').textContent = synthesis.summary || 'No summary available';
                    
                    // Update roles
                    const rolesList = document.getElementById('analysisRoles');
                    if (synthesis.key_roles && synthesis.key_roles.length > 0) {
                        rolesList.innerHTML = synthesis.key_roles.map(role => 
                            `<div class="role-item">${role}</div>`
                        ).join('');
                    } else {
                        rolesList.innerHTML = '<div class="role-item">No roles identified</div>';
                    }
                    
                    // Update timeline
                    const timeline = document.getElementById('analysisTimeline');
                    if (synthesis.timeline && synthesis.timeline.length > 0) {
                        timeline.innerHTML = synthesis.timeline.map(item => 
                            `<div class="timeline-item">
                                <div class="timeline-date">${item.date || 'Unknown'}</div>
                                <div class="timeline-event">${item.event || 'No description'}</div>
                                <div class="timeline-source">${item.source || 'Unknown source'}</div>
                            </div>`
                        ).join('');
                    } else {
                        timeline.innerHTML = '<div class="timeline-item">No timeline data available</div>';
                    }
                    
                    // Update compliance badges
                    const compliance = document.getElementById('analysisCompliance');
                    if (synthesis.consent_badges && synthesis.consent_badges.length > 0) {
                        compliance.innerHTML = synthesis.consent_badges.map(badge => 
                            `<span class="badge privacy">${badge}</span>`
                        ).join('');
                    } else {
                        compliance.innerHTML = '<span class="badge privacy">Public Data</span>';
                    }
                    
                    // Display LinkedIn Profile Analysis if available
                    if (synthesis.linkedin_profile_analysis) {
                        this.displayLinkedInAnalysis(synthesis.linkedin_profile_analysis);
                    }
                    
                    // Show the analysis results
                    analysisResults.style.display = 'block';
                    analysisResults.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    this.addLog(`Failed to fetch report: ${error.message}`, 'error');
                    console.error('Error fetching report:', error);
                    this.displayFallbackResults(subject);
                }
            }
            
            displayLinkedInAnalysis(analysis) {
                const section = document.getElementById('linkedinAnalysisSection');
                section.style.display = 'block';
                
                // Update scores
                document.getElementById('profileStrength').textContent = analysis.profile_strength || '-';
                document.getElementById('profileCompleteness').textContent = 
                    analysis.completeness_score ? `${Math.round(analysis.completeness_score * 100)}%` : '-';
                document.getElementById('keywordScore').textContent = 
                    analysis.keyword_optimization?.score ? `${Math.round(analysis.keyword_optimization.score * 100)}%` : '-';
                document.getElementById('tractionRating').textContent = 
                    analysis.engagement_metrics?.traction_rating || '-';
                
                // Update profile sections
                if (analysis.profile_sections) {
                    const sectionsHtml = Object.entries(analysis.profile_sections).map(([name, data]) => `
                        <div class="section-quality">
                            <div class="section-quality-header">
                                <span class="section-quality-name">${name.charAt(0).toUpperCase() + name.slice(1)}</span>
                                <span class="quality-badge ${data.quality?.toLowerCase() || 'weak'}">${data.quality || 'Unknown'}</span>
                            </div>
                            <div class="section-quality-feedback">${data.feedback || 'No feedback available'}</div>
                        </div>
                    `).join('');
                    document.getElementById('profileSections').innerHTML = sectionsHtml;
                }
                
                // Update keyword analysis
                if (analysis.keyword_optimization) {
                    const keywordsHtml = `
                        <div>
                            <p><strong>Identified Keywords:</strong></p>
                            <div class="keyword-list">
                                ${(analysis.keyword_optimization.identified_keywords || []).map(kw => 
                                    `<span class="keyword-tag">${kw}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <p><strong>Suggested Keywords:</strong></p>
                            <div class="keyword-list">
                                ${(analysis.keyword_optimization.missing_keywords || []).map(kw => 
                                    `<span class="keyword-tag missing">${kw}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                    document.getElementById('keywordAnalysis').innerHTML = keywordsHtml;
                }
                
                // Update engagement metrics
                if (analysis.engagement_metrics) {
                    const metricsHtml = `
                        <p><strong>Followers:</strong> ${analysis.engagement_metrics.followers?.toLocaleString() || 'N/A'}</p>
                        <p><strong>Connections:</strong> ${analysis.engagement_metrics.connections?.toLocaleString() || 'N/A'}</p>
                        <p style="margin-top: 0.5rem;">${analysis.engagement_metrics.analysis || 'No analysis available'}</p>
                    `;
                    document.getElementById('engagementMetrics').innerHTML = metricsHtml;
                }
                
                // Update recommendations
                if (analysis.recommendations && analysis.recommendations.length > 0) {
                    const recsHtml = analysis.recommendations.map(rec => 
                        `<li>${rec}</li>`
                    ).join('');
                    document.getElementById('profileRecommendations').innerHTML = recsHtml;
                } else {
                    document.getElementById('profileRecommendations').innerHTML = '<li>No recommendations available</li>';
                }
            }
            
            displayFallbackResults(subject) {
                // Use mock data as fallback
                const mockAnalysis = this.generateMockAnalysis(subject);
                
                document.getElementById('analysisSubject').textContent = subject;
                document.getElementById('analysisType').textContent = this.inputType === 'linkedin' ? 'LinkedIn Profile' : 'Search Query';
                document.getElementById('analysisConfidence').textContent = `Confidence: ${mockAnalysis.confidence}%`;
                
                document.getElementById('analysisEvidenceCount').textContent = this.evidenceCount;
                document.getElementById('analysisClaimsCount').textContent = Math.floor(this.evidenceCount * 1.8);
                document.getElementById('analysisApiCalls').textContent = this.apiCallsUsed;
                
                document.getElementById('analysisSummary').textContent = mockAnalysis.summary;
                
                const rolesList = document.getElementById('analysisRoles');
                rolesList.innerHTML = mockAnalysis.roles.map(role => 
                    `<div class="role-item">${role}</div>`
                ).join('');
                
                const timeline = document.getElementById('analysisTimeline');
                timeline.innerHTML = mockAnalysis.timeline.map(item => 
                    `<div class="timeline-item">
                        <div class="timeline-date">${item.date}</div>
                        <div class="timeline-event">${item.event}</div>
                        <div class="timeline-source">${item.source}</div>
                    </div>`
                ).join('');
                
                const compliance = document.getElementById('analysisCompliance');
                compliance.innerHTML = mockAnalysis.compliance.map(badge => 
                    `<span class="badge ${badge.type}">${badge.text}</span>`
                ).join('');
                
                const analysisResults = document.getElementById('analysisResults');
                analysisResults.style.display = 'block';
                analysisResults.scrollIntoView({ behavior: 'smooth' });
            }

            generateMockAnalysis(subject) {
                const isLinkedIn = this.inputType === 'linkedin';
                const baseName = isLinkedIn ? subject.split('/').pop() : subject;
                
                return {
                    confidence: Math.floor(Math.random() * 20) + 75, // 75-95%
                    summary: `Based on our analysis of ${isLinkedIn ? 'the LinkedIn profile' : 'publicly available information'} for ${baseName}, we've identified key professional information including current and past positions, educational background, and professional connections. The data shows a strong professional presence with ${this.evidenceCount} evidence points collected from ${isLinkedIn ? 'direct profile scraping' : 'multiple sources'}.`,
                    roles: [
                        isLinkedIn ? 'Current Position: Software Engineer' : 'Software Engineer at Tech Company',
                        isLinkedIn ? 'Previous: Senior Developer' : 'Senior Developer (2020-2023)',
                        isLinkedIn ? 'Education: Computer Science' : 'Computer Science Degree',
                        isLinkedIn ? 'Skills: JavaScript, Python' : 'Key Skills: JavaScript, Python, React'
                    ],
                    timeline: [
                        { date: '2023', event: 'Current position started', source: 'LinkedIn Profile' },
                        { date: '2020', event: 'Previous role began', source: 'Professional History' },
                        { date: '2018', event: 'Education completed', source: 'Academic Records' },
                        { date: '2016', event: 'Career started', source: 'Professional Timeline' }
                    ],
                    compliance: [
                        { type: 'privacy', text: 'Public Data Only' },
                        { type: 'compliance', text: 'GDPR Compliant' },
                        { type: 'verified', text: 'Data Verified' },
                        { type: 'privacy', text: 'No PII Collected' }
                    ]
                };
            }

            handleError(error) {
                this.addLog(`Analysis failed: ${error}`, 'error');
                this.deactivateAllAgents();
                this.isRunning = false;
                this.updateButtons();
                Object.values(this.steps).forEach(step => {
                    if (step.classList.contains('active')) {
                        step.classList.remove('active');
                        step.classList.add('error');
                    }
                });
            }

            startPolling() {
                setInterval(() => {
                    this.checkRunStatus();
                }, 2000);
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new AgentDashboard();
        });
    </script>
</body>
</html>
