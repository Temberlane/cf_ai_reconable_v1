<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconable Lite+ - Real-Time Agent Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agent-status {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .agent {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .agent.active {
            border-left-color: #48bb78;
            background: #f0fff4;
            animation: pulse 2s infinite;
        }

        .agent.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }

        .agent-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .agent-info h3 {
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .agent-info p {
            color: #718096;
            font-size: 0.9rem;
        }

        .agent-status-indicator {
            margin-left: auto;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-idle { background: #e2e8f0; color: #4a5568; }
        .status-active { background: #c6f6d5; color: #22543d; }
        .status-error { background: #fed7d7; color: #742a2a; }
        .status-complete { background: #bee3f8; color: #2a4365; }

        .tool-calls {
            max-height: 400px;
            overflow-y: auto;
        }

        .tool-call {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 3px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .tool-call.active {
            border-left-color: #4299e1;
            background: #ebf8ff;
        }

        .tool-call.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .tool-call.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }

        .tool-icon {
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }

        .tool-info {
            flex: 1;
        }

        .tool-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .tool-description {
            font-size: 0.85rem;
            color: #718096;
        }

        .tool-timestamp {
            font-size: 0.75rem;
            color: #a0aec0;
        }

        .progress-section {
            grid-column: 1 / -1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #48bb78);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .step {
            text-align: center;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .step.active {
            border-color: #4299e1;
            background: #ebf8ff;
        }

        .step.complete {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .step.error {
            border-color: #f56565;
            background: #fed7d7;
        }

        .step-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .step-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .step-description {
            font-size: 0.8rem;
            color: #718096;
        }

        .data-section {
            grid-column: 1 / -1;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .data-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
        }

        .data-card h4 {
            color: #4a5568;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: #2d3748;
        }

        .data-value {
            color: #718096;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
        }

        .logs {
            background: #1a202c;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-timestamp {
            color: #a0aec0;
        }

        .log-level-info { color: #63b3ed; }
        .log-level-success { color: #68d391; }
        .log-level-error { color: #fc8181; }
        .log-level-warning { color: #f6e05e; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Reconable</h1>
            <p>Agent Based LinkedIn Profile Reviewer</p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="form-group" style="margin-bottom: 0; display: flex; gap: 1rem; align-items: end;">
                <div>
                    <label for="subject">Subject to Analyze:</label>
                    <input type="text" id="subject" placeholder="Enter subject name" value="John Smith">
                </div>
                <button id="startBtn" class="btn">üöÄ Start Analysis</button>
                <button id="stopBtn" class="btn btn-danger" disabled>‚èπÔ∏è Stop</button>
                <button id="clearBtn" class="btn">üóëÔ∏è Clear</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalRuns">0</div>
                <div class="stat-label">Total Runs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeRuns">0</div>
                <div class="stat-label">Active Runs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="toolCalls">0</div>
                <div class="stat-label">Tool Calls</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="evidenceCollected">0</div>
                <div class="stat-label">Evidence Items</div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="card progress-section">
            <h2>üìä Analysis Progress</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" id="step-intake">
                    <div class="step-icon">üì•</div>
                    <div class="step-name">Intake</div>
                    <div class="step-description">Subject received</div>
                </div>
                <div class="step" id="step-discover">
                    <div class="step-icon">üîç</div>
                    <div class="step-name">Discover</div>
                    <div class="step-description">Finding sources</div>
                </div>
                <div class="step" id="step-fetch">
                    <div class="step-icon">üåê</div>
                    <div class="step-name">Fetch</div>
                    <div class="step-description">Web scraping</div>
                </div>
                <div class="step" id="step-normalize">
                    <div class="step-icon">üîÑ</div>
                    <div class="step-name">Normalize</div>
                    <div class="step-description">Processing data</div>
                </div>
                <div class="step" id="step-extract">
                    <div class="step-icon">üìù</div>
                    <div class="step-name">Extract</div>
                    <div class="step-description">AI extraction</div>
                </div>
                <div class="step" id="step-verify">
                    <div class="step-icon">‚úÖ</div>
                    <div class="step-name">Verify</div>
                    <div class="step-description">Compliance check</div>
                </div>
                <div class="step" id="step-upsert">
                    <div class="step-icon">üíæ</div>
                    <div class="step-name">Upsert</div>
                    <div class="step-description">Store in memory</div>
                </div>
                <div class="step" id="step-synthesize">
                    <div class="step-icon">üìä</div>
                    <div class="step-name">Synthesize</div>
                    <div class="step-description">Generate report</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Agent Status -->
            <div class="card">
                <h2>ü§ñ Agent Status</h2>
                <div class="agent-status">
                    <div class="agent" id="agent-orchestrator">
                        <div class="agent-icon">üéØ</div>
                        <div class="agent-info">
                            <h3>Subject Orchestrator</h3>
                            <p>Manages the analysis pipeline</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                    <div class="agent" id="agent-harvester">
                        <div class="agent-icon">üåê</div>
                        <div class="agent-info">
                            <h3>Harvester Agent</h3>
                            <p>Web scraping and data collection</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                    <div class="agent" id="agent-compliance">
                        <div class="agent-icon">üõ°Ô∏è</div>
                        <div class="agent-info">
                            <h3>Compliance Agent</h3>
                            <p>Privacy and data verification</p>
                        </div>
                        <div class="agent-status-indicator status-idle">Idle</div>
                    </div>
                </div>
            </div>

            <!-- Tool Calls -->
            <div class="card">
                <h2>üîß Tool Calls</h2>
                <div class="tool-calls" id="toolCallsList">
                    <div style="text-align: center; color: #a0aec0; padding: 2rem;">
                        No tool calls yet. Start an analysis to see activity.
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Section -->
        <div class="card data-section">
            <h2>üìä Collected Data</h2>
            <div class="data-grid">
                <div class="data-card">
                    <h4>üåê Web Search Results</h4>
                    <div id="webData">
                        <div class="data-item">
                            <span class="data-label">Status:</span>
                            <span class="data-value">Not started</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>üíº LinkedIn Profiles</h4>
                    <div id="linkedinData">
                        <div class="data-item">
                            <span class="data-label">Profiles Found:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Profiles Scraped:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>üè¢ Company Data</h4>
                    <div id="companyData">
                        <div class="data-item">
                            <span class="data-label">Companies Found:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Data Points:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <h4>üìù AI Analysis</h4>
                    <div id="aiData">
                        <div class="data-item">
                            <span class="data-label">Claims Extracted:</span>
                            <span class="data-value">0</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Claims Verified:</span>
                            <span class="data-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <h2>üìã Activity Logs</h2>
            <div class="logs" id="logs">
                <div class="log-entry">
                    <span class="log-timestamp">[00:00:00]</span>
                    <span class="log-level-info">[INFO]</span>
                    <span>Dashboard initialized. Ready to start analysis.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AgentDashboard {
            constructor() {
                this.currentRunId = null;
                this.isRunning = false;
                this.agents = {
                    orchestrator: document.getElementById('agent-orchestrator'),
                    harvester: document.getElementById('agent-harvester'),
                    compliance: document.getElementById('agent-compliance')
                };
                this.steps = {
                    intake: document.getElementById('step-intake'),
                    discover: document.getElementById('step-discover'),
                    fetch: document.getElementById('step-fetch'),
                    normalize: document.getElementById('step-normalize'),
                    extract: document.getElementById('step-extract'),
                    verify: document.getElementById('step-verify'),
                    upsert: document.getElementById('step-upsert'),
                    synthesize: document.getElementById('step-synthesize')
                };
                this.stats = {
                    totalRuns: document.getElementById('totalRuns'),
                    activeRuns: document.getElementById('activeRuns'),
                    toolCalls: document.getElementById('toolCalls'),
                    evidenceCollected: document.getElementById('evidenceCollected')
                };
                this.toolCallsList = document.getElementById('toolCallsList');
                this.logs = document.getElementById('logs');
                this.progressFill = document.getElementById('progressFill');
                
                this.toolCallCount = 0;
                this.evidenceCount = 0;
                this.totalRuns = 0;
                
                this.initializeEventListeners();
                this.startPolling();
            }

            initializeEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startAnalysis());
                document.getElementById('stopBtn').addEventListener('click', () => this.stopAnalysis());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearDashboard());
            }

            async startAnalysis() {
                const subject = document.getElementById('subject').value.trim();
                if (!subject) {
                    this.addLog('Please enter a subject name.', 'error');
                    return;
                }

                this.isRunning = true;
                this.updateButtons();
                this.resetDashboard();
                this.addLog(`Starting analysis for: ${subject}`, 'info');

                try {
                    const response = await fetch('/api/run', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ subject })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        this.currentRunId = data.runId;
                        this.totalRuns++;
                        this.updateStats();
                        this.addLog(`Analysis started with Run ID: ${data.runId}`, 'success');
                        this.activateAgent('orchestrator');
                        this.activateStep('intake');
                    } else {
                        this.addLog(`Failed to start analysis: ${data.error}`, 'error');
                        this.isRunning = false;
                        this.updateButtons();
                    }
                } catch (error) {
                    this.addLog(`Network error: ${error.message}`, 'error');
                    this.isRunning = false;
                    this.updateButtons();
                }
            }

            async stopAnalysis() {
                this.isRunning = false;
                this.updateButtons();
                this.addLog('Analysis stopped by user', 'warning');
                this.deactivateAllAgents();
                this.resetSteps();
            }

            clearDashboard() {
                this.resetDashboard();
                this.addLog('Dashboard cleared', 'info');
            }

            resetDashboard() {
                this.deactivateAllAgents();
                this.resetSteps();
                this.toolCallsList.innerHTML = '<div style="text-align: center; color: #a0aec0; padding: 2rem;">No tool calls yet. Start an analysis to see activity.</div>';
                this.progressFill.style.width = '0%';
                this.updateDataDisplays();
            }

            updateButtons() {
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                startBtn.disabled = this.isRunning;
                stopBtn.disabled = !this.isRunning;
                
                if (this.isRunning) {
                    startBtn.innerHTML = '<span class="loading"></span> Running...';
                } else {
                    startBtn.innerHTML = 'üöÄ Start Analysis';
                }
            }

            activateAgent(agentName) {
                const agent = this.agents[agentName];
                agent.classList.add('active');
                agent.querySelector('.agent-status-indicator').textContent = 'Active';
                agent.querySelector('.agent-status-indicator').className = 'agent-status-indicator status-active';
            }

            deactivateAgent(agentName) {
                const agent = this.agents[agentName];
                agent.classList.remove('active');
                agent.querySelector('.agent-status-indicator').textContent = 'Idle';
                agent.querySelector('.agent-status-indicator').className = 'agent-status-indicator status-idle';
            }

            deactivateAllAgents() {
                Object.keys(this.agents).forEach(agentName => this.deactivateAgent(agentName));
            }

            activateStep(stepName) {
                const step = this.steps[stepName];
                step.classList.add('active');
                this.updateProgress();
            }

            completeStep(stepName) {
                const step = this.steps[stepName];
                step.classList.remove('active');
                step.classList.add('complete');
                this.updateProgress();
            }

            resetSteps() {
                Object.values(this.steps).forEach(step => {
                    step.classList.remove('active', 'complete', 'error');
                });
            }

            updateProgress() {
                const activeSteps = Object.values(this.steps).filter(step => 
                    step.classList.contains('active') || step.classList.contains('complete')
                ).length;
                const progress = (activeSteps / Object.keys(this.steps).length) * 100;
                this.progressFill.style.width = `${progress}%`;
            }

            addToolCall(toolName, description, status = 'active') {
                this.toolCallCount++;
                this.updateStats();

                const toolCall = document.createElement('div');
                toolCall.className = `tool-call ${status}`;
                
                const icons = {
                    'searchWeb': 'üîç',
                    'fetchWeb': 'üåê',
                    'scrapeLinkedInProfile': 'üíº',
                    'searchLinkedInProfiles': 'üîé',
                    'scrapeLinkedInCompany': 'üè¢',
                    'extractClaims': 'üìù',
                    'verifyClaims': '‚úÖ',
                    'synthesizeReport': 'üìä'
                };

                toolCall.innerHTML = `
                    <div class="tool-icon">${icons[toolName] || 'üîß'}</div>
                    <div class="tool-info">
                        <div class="tool-name">${toolName}</div>
                        <div class="tool-description">${description}</div>
                    </div>
                    <div class="tool-timestamp">${new Date().toLocaleTimeString()}</div>
                `;

                if (this.toolCallsList.children.length === 1 && this.toolCallsList.children[0].textContent.includes('No tool calls')) {
                    this.toolCallsList.innerHTML = '';
                }

                this.toolCallsList.insertBefore(toolCall, this.toolCallsList.firstChild);

                // Keep only last 20 tool calls
                while (this.toolCallsList.children.length > 20) {
                    this.toolCallsList.removeChild(this.toolCallsList.lastChild);
                }
            }

            addLog(message, level = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                    <span>${message}</span>
                `;
                
                this.logs.appendChild(logEntry);
                this.logs.scrollTop = this.logs.scrollHeight;

                // Keep only last 100 log entries
                while (this.logs.children.length > 100) {
                    this.logs.removeChild(this.logs.firstChild);
                }
            }

            updateStats() {
                this.stats.totalRuns.textContent = this.totalRuns;
                this.stats.activeRuns.textContent = this.isRunning ? '1' : '0';
                this.stats.toolCalls.textContent = this.toolCallCount;
                this.stats.evidenceCollected.textContent = this.evidenceCount;
            }

            updateDataDisplays() {
                // Update web data
                document.querySelector('#webData .data-value').textContent = this.isRunning ? 'In progress...' : 'Not started';
                
                // Update LinkedIn data
                const linkedinProfiles = document.querySelectorAll('#linkedinData .data-value');
                if (linkedinProfiles.length >= 2) {
                    linkedinProfiles[0].textContent = this.evidenceCount;
                    linkedinProfiles[1].textContent = this.evidenceCount;
                }
                
                // Update company data
                const companyData = document.querySelectorAll('#companyData .data-value');
                if (companyData.length >= 2) {
                    companyData[0].textContent = Math.floor(this.evidenceCount / 2);
                    companyData[1].textContent = this.evidenceCount * 3;
                }
                
                // Update AI data
                const aiData = document.querySelectorAll('#aiData .data-value');
                if (aiData.length >= 2) {
                    aiData[0].textContent = this.evidenceCount * 2;
                    aiData[1].textContent = Math.floor(this.evidenceCount * 1.8);
                }
            }

            async checkRunStatus() {
                if (!this.currentRunId || !this.isRunning) return;

                try {
                    const response = await fetch(`/api/run/${this.currentRunId}/status`);
                    const data = await response.json();

                    if (response.ok) {
                        this.updateRunStatus(data);
                    }
                } catch (error) {
                    console.error('Failed to check run status:', error);
                }
            }

            updateRunStatus(runData) {
                const status = runData.status;
                
                // Update steps based on status
                const stepMapping = {
                    'intake': 'intake',
                    'discover': 'discover',
                    'fetch': 'fetch',
                    'normalize': 'normalize',
                    'extract': 'extract',
                    'verify': 'verify',
                    'upsert': 'upsert',
                    'synthesize': 'synthesize',
                    'completed': 'synthesize',
                    'error': 'error'
                };

                if (status === 'completed') {
                    this.completeAnalysis();
                } else if (status === 'error') {
                    this.handleError(runData.error);
                } else {
                    this.simulateProgress(status);
                }
            }

            simulateProgress(currentStatus) {
                // Simulate realistic progress with tool calls
                const progressSequence = [
                    { step: 'intake', agent: 'orchestrator', tool: 'initializeRun', desc: 'Initializing analysis run' },
                    { step: 'discover', agent: 'harvester', tool: 'searchWeb', desc: 'Searching web for general information' },
                    { step: 'discover', agent: 'harvester', tool: 'searchLinkedInProfiles', desc: 'Searching LinkedIn profiles' },
                    { step: 'fetch', agent: 'harvester', tool: 'scrapeLinkedInProfile', desc: 'Scraping LinkedIn profile data' },
                    { step: 'fetch', agent: 'harvester', tool: 'fetchWeb', desc: 'Fetching additional web content' },
                    { step: 'normalize', agent: 'orchestrator', tool: 'processEvidence', desc: 'Processing collected evidence' },
                    { step: 'extract', agent: 'orchestrator', tool: 'extractClaims', desc: 'Extracting claims using AI' },
                    { step: 'verify', agent: 'compliance', tool: 'verifyClaims', desc: 'Verifying claims for compliance' },
                    { step: 'upsert', agent: 'orchestrator', tool: 'storeClaims', desc: 'Storing claims in memory' },
                    { step: 'synthesize', agent: 'orchestrator', tool: 'synthesizeReport', desc: 'Generating final report' }
                ];

                const currentIndex = progressSequence.findIndex(p => p.step === currentStatus);
                if (currentIndex >= 0) {
                    const current = progressSequence[currentIndex];
                    this.activateAgent(current.agent);
                    this.activateStep(current.step);
                    this.addToolCall(current.tool, current.desc, 'active');
                    
                    // Simulate evidence collection
                    if (current.step === 'fetch') {
                        this.evidenceCount += Math.floor(Math.random() * 3) + 1;
                        this.updateStats();
                        this.updateDataDisplays();
                    }
                }
            }

            completeAnalysis() {
                this.addLog('Analysis completed successfully!', 'success');
                this.completeStep('synthesize');
                this.deactivateAllAgents();
                this.isRunning = false;
                this.updateButtons();
                this.evidenceCount += Math.floor(Math.random() * 5) + 3;
                this.updateStats();
                this.updateDataDisplays();
            }

            handleError(error) {
                this.addLog(`Analysis failed: ${error}`, 'error');
                this.deactivateAllAgents();
                this.isRunning = false;
                this.updateButtons();
                Object.values(this.steps).forEach(step => {
                    if (step.classList.contains('active')) {
                        step.classList.remove('active');
                        step.classList.add('error');
                    }
                });
            }

            startPolling() {
                setInterval(() => {
                    this.checkRunStatus();
                }, 2000);
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new AgentDashboard();
        });
    </script>
</body>
</html>
